# Chrono Lite åˆ†é˜¶æ®µå®æ–½è®¡åˆ’

## æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾› Chrono Lite Gmail Add-on çš„å®Œæ•´å®æ–½è®¡åˆ’ï¼Œå°†é¡¹ç›®æ‹†åˆ†ä¸º7ä¸ªç‹¬ç«‹å¯éªŒè¯çš„é˜¶æ®µã€‚ç”±äº Apps Script è°ƒè¯•å›°éš¾ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½åŒ…å«è¯¦ç»†çš„éªŒè¯æ­¥éª¤å’Œé¢„æœŸè¾“å‡ºã€‚

## æ ¸å¿ƒæŒ‘æˆ˜

### Apps Script ç‰¹æœ‰çš„æŠ€æœ¯é™åˆ¶

| é™åˆ¶ç±»å‹ | å…·ä½“çº¦æŸ | åº”å¯¹ç­–ç•¥ |
|---------|---------|---------|
| **è°ƒè¯•èƒ½åŠ›** | æ— æ–­ç‚¹è°ƒè¯•ï¼ŒLogger è¾“å‡ºæœ‰é™ | è¯¦ç»†æ—¥å¿— + å•å…ƒæµ‹è¯•å‡½æ•° |
| **æ‰§è¡Œæ—¶é—´** | å•æ¬¡è¿è¡Œ 6 åˆ†é’Ÿä¸Šé™ | åˆ†æ‰¹å¤„ç† + æ–­ç‚¹ç»­è·‘ |
| **ç¼“å­˜é™åˆ¶** | 1000 æ¡ç›® + 100KB/æ¡ç›® | åˆ†ç‰‡å­˜å‚¨ç­–ç•¥ |
| **API é…é¢** | Gmail API æœ‰æ—¥é™é¢ | æ‰¹é‡æ“ä½œ + èŠ‚æµ |
| **UI æµ‹è¯•** | Card Service éš¾ä»¥å•ç‹¬æµ‹è¯• | æ¨¡æ‹Ÿ event å¯¹è±¡ |

## å®æ–½åŸåˆ™

### 1. ç”±å†…è€Œå¤–ï¼ˆInside-Outï¼‰

```
æ•°æ®å±‚ï¼ˆæœ€åº•å±‚ï¼‰
    â†“
åˆ†ç±»å¼•æ“ï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
    â†“
åŠ¨ä½œæ‰§è¡Œï¼ˆGmail æ“ä½œï¼‰
    â†“
UI å±‚ï¼ˆCard Serviceï¼‰
    â†“
è§¦å‘å™¨ï¼ˆè‡ªåŠ¨åŒ–ï¼‰
```

### 2. æ¸è¿›å¼éªŒè¯ï¼ˆIncremental Verificationï¼‰

æ¯ä¸ªæ¨¡å—å®Œæˆåç«‹å³éªŒè¯ï¼Œä¸ä¾èµ–åç»­æ¨¡å—ï¼š

- âœ… **Phase 1** å®Œæˆ â†’ éªŒè¯æ•°æ®åŠ è½½å’Œç¼“å­˜
- âœ… **Phase 2** å®Œæˆ â†’ éªŒè¯åˆ†ç±»å‡†ç¡®ç‡
- âœ… **Phase 3** å®Œæˆ â†’ éªŒè¯ Gmail æ“ä½œ
- âœ… **Phase 4** å®Œæˆ â†’ éªŒè¯ UI æ˜¾ç¤º
- âœ… **Phase 5** å®Œæˆ â†’ éªŒè¯è‡ªåŠ¨åŒ–æµç¨‹

### 3. å°æ•°æ®é›†æµ‹è¯•ï¼ˆSmall Dataset Firstï¼‰

å…ˆç”¨ 10-20 æ¡æ•°æ®éªŒè¯é€»è¾‘ï¼Œå†æ‰©å±•åˆ°å®Œæ•´æ•°æ®é›†ï¼š

```javascript
// å¼€å‘é˜¶æ®µ
const TEST_SENDERS = {
  'newsletter@stratechery.com': { category: 'Newsletter' },
  'promo@amazon.com': { category: 'Marketing' }
  // ... ä»… 20 æ¡
};

// éªŒè¯é€šè¿‡åï¼Œåˆ‡æ¢åˆ°å®Œæ•´æ•°æ®åº“
const SENDER_DB_URL = 'https://cdn.jsdelivr.net/gh/...';
```

## å®æ–½é˜¶æ®µæ€»è§ˆ

| é˜¶æ®µ | åç§° | å·¥ä½œé‡ | å…³é”®éªŒè¯ç‚¹ | æ–‡æ¡£ |
|-----|------|-------|-----------|------|
| **Phase 0** | ç¯å¢ƒå‡†å¤‡ | 0.5å¤© | Apps Script é¡¹ç›®åˆ›å»ºæˆåŠŸ | [è¯¦è§](./Phase-0-Setup.md) |
| **Phase 1** | æ•°æ®å±‚ | 2-3å¤© | CDN åŠ è½½ + åˆ†ç‰‡ç¼“å­˜å·¥ä½œ | [è¯¦è§](./Phase-1-DataLayer.md) |
| **Phase 2** | åˆ†ç±»å¼•æ“ | 2å¤© | å‡†ç¡®ç‡ >85% | [è¯¦è§](./Phase-2-Classifier.md) |
| **Phase 3** | åŠ¨ä½œæ‰§è¡Œ | 1å¤© | æ ‡ç­¾ã€å½’æ¡£æ­£ç¡®æ‰§è¡Œ | [è¯¦è§](./Phase-3-Actions.md) |
| **Phase 4** | UI å±‚ | 2-3å¤© | ä¾§è¾¹æ å¡ç‰‡æ­£å¸¸æ˜¾ç¤º | [è¯¦è§](./Phase-4-UI.md) |
| **Phase 5** | è§¦å‘å™¨ | 1-2å¤© | å®šæ—¶ä»»åŠ¡è‡ªåŠ¨è¿è¡Œ | [è¯¦è§](./Phase-5-Triggers.md) |
| **Phase 6** | é›†æˆæµ‹è¯• | 2-3å¤© | ç«¯åˆ°ç«¯æµç¨‹éªŒè¯ | [è¯¦è§](./Phase-6-Integration.md) |

**æ€»å·¥ä½œé‡**ï¼š10-14 å¤©ï¼ˆæ»¡è´Ÿè·å¼€å‘ï¼‰

## éªŒè¯æ–¹æ³•çŸ©é˜µ

| éªŒè¯ç±»å‹ | é€‚ç”¨é˜¶æ®µ | æ–¹æ³• | å·¥å…· |
|---------|---------|-----|------|
| **åŠŸèƒ½éªŒè¯** | æ‰€æœ‰é˜¶æ®µ | è¿è¡Œæµ‹è¯•å‡½æ•°ï¼Œæ£€æŸ¥ Logger è¾“å‡º | `Logger.log()` |
| **æ€§èƒ½éªŒè¯** | Phase 1, 2, 3 | æµ‹é‡æ‰§è¡Œæ—¶é—´å’Œé…é¢æ¶ˆè€— | `new Date()` è®¡æ—¶ |
| **UI éªŒè¯** | Phase 4 | åœ¨ Gmail ä¾§è¾¹æ æŸ¥çœ‹å®é™…æ˜¾ç¤º | Gmail ç•Œé¢ |
| **é›†æˆéªŒè¯** | Phase 6 | å®Œæ•´ç”¨æˆ·æµç¨‹æµ‹è¯• | Gmail + Apps Script |
| **é”™è¯¯æ³¨å…¥** | Phase 1, 5 | æ¨¡æ‹Ÿç½‘ç»œå¤±è´¥ã€é…é¢è¶…é™ | `throw new Error()` |

## å¿«é€Ÿå¼€å§‹

### æ¨èå¼€å‘æµç¨‹

```bash
# 1. å…‹éš†ä»“åº“ï¼ˆå¦‚æœå·²æœ‰ï¼‰
git clone https://github.com/yourusername/chrono-lite.git
cd chrono-lite

# 2. é˜…è¯»å„é˜¶æ®µæ–‡æ¡£
docs/implementation/Phase-0-Setup.md        # å…ˆè¯»è¿™ä¸ª
docs/implementation/Phase-1-DataLayer.md    # ç„¶åå¼€å§‹å®æ–½
# ...

# 3. ä½¿ç”¨ clasp éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰
npm install -g @google/clasp
clasp login
clasp create --type standalone --title "Chrono Lite"
clasp push
```

### æ ¸å¿ƒä»£ç æ¨¡å—

```
src/
â”œâ”€â”€ Code.gs              # ä¸»å…¥å£ï¼ˆPhase 0ï¼‰
â”œâ”€â”€ Config.gs            # é…ç½®å¸¸é‡ï¼ˆPhase 0ï¼‰
â”œâ”€â”€ Database.gs          # æ•°æ®å±‚ï¼ˆPhase 1ï¼‰
â”œâ”€â”€ Classifier.gs        # åˆ†ç±»å¼•æ“ï¼ˆPhase 2ï¼‰
â”œâ”€â”€ Actions.gs           # åŠ¨ä½œæ‰§è¡Œï¼ˆPhase 3ï¼‰
â”œâ”€â”€ UI.gs                # Card Service UIï¼ˆPhase 4ï¼‰
â”œâ”€â”€ Triggers.gs          # è§¦å‘å™¨ç®¡ç†ï¼ˆPhase 5ï¼‰
â””â”€â”€ Utils.gs             # å·¥å…·å‡½æ•°ï¼ˆæ‰€æœ‰é˜¶æ®µï¼‰
```

## æˆåŠŸæ ‡å‡†

### å„é˜¶æ®µé€šè¿‡æ ‡å‡†

#### Phase 0 âœ…
- Apps Script é¡¹ç›®åˆ›å»ºæˆåŠŸ
- `testHelloWorld()` å‡½æ•°è¿è¡ŒæˆåŠŸ
- Logger è¾“å‡ºå¯è§

#### Phase 1 âœ…
- CDN æ•°æ®åŠ è½½æˆåŠŸï¼ˆ<1ç§’ï¼‰
- åˆ†ç‰‡ç¼“å­˜å­˜å‚¨æˆåŠŸï¼ˆ50 ä¸ªåˆ†ç‰‡ï¼‰
- `querySender()` æŸ¥è¯¢é€Ÿåº¦ <10ms
- ç¼“å­˜å‘½ä¸­ç‡ >95%

#### Phase 2 âœ…
- å•å°é‚®ä»¶åˆ†ç±»å‡†ç¡®ç‡ >90%
- æ‰¹é‡åˆ†ç±»ï¼ˆ100 å°ï¼‰è€—æ—¶ <5 ç§’
- ä¸‰çº§åŒ¹é…ç­–ç•¥å…¨éƒ¨å·¥ä½œ

#### Phase 3 âœ…
- æ ‡ç­¾åˆ›å»º/åº”ç”¨æˆåŠŸ
- å½’æ¡£ã€å·²è¯»æ“ä½œæ­£ç¡®
- æ‰¹é‡æ“ä½œæ— é”™è¯¯

#### Phase 4 âœ…
- Homepage Card æ­£å¸¸æ˜¾ç¤º
- Context Card æ­£ç¡®æ˜¾ç¤ºåˆ†ç±»ç»“æœ
- æŒ‰é’®ç‚¹å‡»è§¦å‘æ­£ç¡®çš„åŠ¨ä½œ

#### Phase 5 âœ…
- Time-based Trigger è‡ªåŠ¨è¿è¡Œ
- å¢é‡å¤„ç†ï¼ˆä»…å¤„ç†æ–°é‚®ä»¶ï¼‰
- è¶…æ—¶ä¿æŠ¤ç”Ÿæ•ˆ

#### Phase 6 âœ…
- å®Œæ•´ç”¨æˆ·æµç¨‹æ— é˜»å¡
- æ€§èƒ½æ»¡è¶³åŸºå‡†è¦æ±‚
- é”™è¯¯æ¢å¤æœºåˆ¶å·¥ä½œ

## å¼€å‘å·¥å…·æ¨è

### å¿…å¤‡å·¥å…·

| å·¥å…· | ç”¨é€” | å®‰è£… |
|-----|------|-----|
| **clasp** | å‘½ä»¤è¡Œéƒ¨ç½² | `npm install -g @google/clasp` |
| **Apps Script Editor** | åœ¨çº¿å¼€å‘ | https://script.google.com |
| **Gmail Test Account** | æµ‹è¯•é‚®ä»¶ | åˆ›å»ºæµ‹è¯• Gmail è´¦å· |

### å¯é€‰å·¥å…·

| å·¥å…· | ç”¨é€” |
|-----|------|
| **Postman** | æµ‹è¯• Gmail API |
| **JSON Validator** | éªŒè¯æ•°æ®åº“æ ¼å¼ |
| **Chrome DevTools** | æ£€æŸ¥ä¾§è¾¹æ  UI |

## å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ

### é™·é˜± #1ï¼šè¿‡æ—©ä¼˜åŒ–

âŒ **é”™è¯¯åšæ³•**ï¼š
```javascript
// ä¸€å¼€å§‹å°±å®ç°å®Œæ•´çš„ 5000 æ¡æ•°æ®åº“
var db = loadFullDatabase(); // å¯èƒ½å¤±è´¥
```

âœ… **æ­£ç¡®åšæ³•**ï¼š
```javascript
// Phase 1ï¼šå…ˆç”¨ 10 æ¡æµ‹è¯•æ•°æ®
var TEST_DB = { 'test@example.com': { category: 'Newsletter' } };

// Phase 6ï¼šå†åˆ‡æ¢åˆ°å®Œæ•´æ•°æ®åº“
var db = loadSenderDatabase();
```

### é™·é˜± #2ï¼šå¿½ç•¥æ‰§è¡Œæ—¶é—´

âŒ **é”™è¯¯åšæ³•**ï¼š
```javascript
// ä¸€æ¬¡æ€§å¤„ç†æ‰€æœ‰é‚®ä»¶ï¼Œå¯èƒ½è¶…æ—¶
var threads = GmailApp.search('in:inbox', 0, 10000); // ğŸ’¥
```

âœ… **æ­£ç¡®åšæ³•**ï¼š
```javascript
// åˆ†æ‰¹å¤„ç†ï¼Œå¸¦æ—¶é—´ä¿æŠ¤
var MAX_TIME = 5 * 60 * 1000; // 5 åˆ†é’Ÿ
var start = new Date();
for (var offset = 0; offset < 10000; offset += 100) {
  if (new Date() - start > MAX_TIME) break; // æå‰é€€å‡º
  var threads = GmailApp.search('in:inbox', offset, 100);
  // å¤„ç†...
}
```

### é™·é˜± #3ï¼šç¼“å­˜å¤§å°è¶…é™

âŒ **é”™è¯¯åšæ³•**ï¼š
```javascript
// å°†æ•´ä¸ªæ•°æ®åº“å­˜ä¸ºå•ä¸ª JSONï¼ˆå¯èƒ½ >100KBï¼‰
cache.put('full_db', JSON.stringify(allSenders)); // ğŸ’¥
```

âœ… **æ­£ç¡®åšæ³•**ï¼š
```javascript
// åˆ†ç‰‡å­˜å‚¨ï¼ˆæ¯ç‰‡ <10KBï¼‰
for (var i = 0; i < shards.length; i++) {
  cache.put('shard_' + i, JSON.stringify(shards[i]));
}
```

## å…³é”®æ€§èƒ½æŒ‡æ ‡

### ç›®æ ‡åŸºå‡†

| æ“ä½œ | ç›®æ ‡å»¶è¿Ÿ | éªŒè¯é˜¶æ®µ |
|-----|---------|---------|
| æ•°æ®åº“é¦–æ¬¡åŠ è½½ | <1ç§’ | Phase 1 |
| ç¼“å­˜å‘½ä¸­æŸ¥è¯¢ | <10ms | Phase 1 |
| å•å°é‚®ä»¶åˆ†ç±» | <50ms | Phase 2 |
| æ‰¹é‡100å°åˆ†ç±» | <5ç§’ | Phase 2 |
| æ ‡ç­¾æ“ä½œ | <200ms | Phase 3 |
| UI å¡ç‰‡æ¸²æŸ“ | <500ms | Phase 4 |

## ä¸‹ä¸€æ­¥

1. ğŸ“– **é˜…è¯»** [Phase 0: ç¯å¢ƒå‡†å¤‡](./Phase-0-Setup.md)
2. ğŸ’» **å®æ–½** Phase 0ï¼ŒéªŒè¯ç¯å¢ƒæ­£å¸¸
3. âœ… **éªŒè¯** é€šè¿‡åè¿›å…¥ Phase 1
4. ğŸ” **é‡å¤** 2-3ï¼Œç›´åˆ° Phase 6 å®Œæˆ

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šV1.0  
**æœ€åæ›´æ–°**ï¼š2025-10-14  
**ç»´æŠ¤è€…**ï¼šChrono Lite Team  
**åé¦ˆ**ï¼šè¯·æäº¤ GitHub Issue

